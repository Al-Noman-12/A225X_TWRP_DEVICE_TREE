#!/sbin/sh

OUTFD=$2

ui_print() {
  echo -ne "ui_print $1\n" >> /proc/self/fd/$OUTFD
  echo -ne "ui_print\n" >> /proc/self/fd/$OUTFD
}

ui_print "..............................."
ui_print "..............................."
ui_print "..............................."
ui_print "Samsung partition mount helper. Made from samsung multi disabler."
ui_print "..............................."
ui_print "..............................."
ui_print "Mounting $ANDROID_ROOT"
mount $ANDROID_ROOT 2>/dev/null
mount -o remount,rw $ANDROID_ROOT 2>/dev/null

if ! mount | grep $ANDROID_ROOT >/dev/null; then
  ANDROID_ROOT=/system_root
  ui_print "Attempt failed. Mounting at $ANDROID_ROOT"
  mount -o rw $ANDROID_ROOT
  if ! mount | grep $ANDROID_ROOT >/dev/null; then
    ui_print "Even that attempt failed. Aborting"
    exit 2
  fi
fi

ui_print "..............................."
ui_print "..............................."
ui_print "Mounting odm, product, vendor"
mount /odm
mount -o remount,rw /odm
mount /product
mount -o remount,rw /product
mount /vendor
mount -o remount,rw /vendor

if ! mount | grep /odm >/dev/null; then
  ui_print "odm mount failed. Aborting..."
  exit 3
fi

if ! mount | grep /product >/dev/null; then
  ui_print "protuct mount failed. Aborting..."
  exit 3
fi

if ! mount | grep /vendor >/dev/null; then
  ui_print "vendor mount failed. Aborting..."
  exit 3
fi

ui_print "..............................."
ui_print "..............................."
ui_print "Mounting optics, prism........."
mount /optics
mount -o remount,rw /optics
mount /prism
mount -o remount,rw /prism

if ! mount | grep /optics >/dev/null; then
  ui_print "optics mount failed. Aborting..."
  exit 3
fi

if ! mount | grep /prism >/dev/null; then
  ui_print "prism mount failed. Aborting..."
  exit 3
fi

ui_print "..............................."
ui_print "..............................."
ui_print "......Mounting Finished........"
ui_print "..............................."
ui_print "..............................."
